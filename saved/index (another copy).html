
<html>

<head>

	<meta http-equiv="Content-Type" content="text/html; charset=cp1251">

	<style type='text/css'>
		
		body { 
			background-color: #FAFCFF;
			font-family: sans-serif; 
			scroll-behavior: smooth;
			margin:0; padding:0;
		}
		
		.header {
			position:fixed; left:0; top:0; z-index:999; height:60px; width:100%; margin:0; padding:0; display:block;
			border-bottom:0px solid #06446D; background-color:#06446D;
		}
		.menu {
			height:60px; margin:0px 0px 0px 24px; padding:0px; text-align:left; display:table;
		}
		.menu div {
			height:100%; margin-left:4px; padding:0px 8px 0px 8px; display:table-cell; vertical-align:middle; 
			font-size:18px;
		}
		.menu div.normal { color:white; }
		.menu div.active { color:#EFC133; padding-top:4px; border-bottom:4px solid #EFC133; }
		.menu .logo {
			width:241px; height:60px; display:table-cell; margin:0px 24px 0px 24px; vertical-align:middle;
			background: 
				url(data:image/png;base64,XXXX)
				no-repeat left;
		}
		 
		.content {
			width:100%;
			position: absolute; top:60px; left:0px;
			border-top:0px solid white;
			margin:0; padding:0;
			background-color:#ffffff;
		}		

		.page {
			display:none;
			width:100%;
			margin:0; padding:0;
			background-color:#ffffff;
			padding-bottom:4%; 
		}


		div.table-row {
			display:table;
			margin:0; padding:0;			
		}
		
		div.table-row div {
			width:33vw; height:20vh; padding:2%; background-color:#ffffff; color:white; text-align:center; display:table-cell; vertical-align:middle;
			margin:0; padding:0;			
		}
		div.table-row div div {
			background-color:#2B6D9A; color:white; text-align:center; 
			margin:0; padding:0;			
		}

		ul {
			list-style-image:url(data:image/png;base64,XXXX);
		}
		ul li {
			margin:4%;
			font-size:140%;
		}
    	
    	h1 { margin:2% 1% 1% 4%; font-size:140%; color:#06446D; font-variant:small-caps; }


	</style>
	
	<script type='text/javascript'>
		
		var aPages;
		var aMenuIds;
		var sMenuActiveId="";
				
		window.onload = function() {
			aPages = document.querySelectorAll('[data-pageid]');
			for( var i = 0 ; i < aPages.length ; i++ ) {
				aPages[i].className='page';
			}
			
			aMenuIds = document.querySelectorAll('[data-menuid]');
			for( var i = 0 ; i < aMenuIds.length ; i++ ) {
				aMenuIds[i].style.cursor = 'pointer';
				aMenuIds[i].className = 'normal';
				aMenuIds[i].onclick = function() {
					menuGoTo( this.getAttribute("data-menuid") );
				}
			}

			menuGoTo( "main" );
		}	
		
		function menuGoTo( sId ) {		
			
			for( var i = 0 ; i < aPages.length ; i++ ) {
				sPageId = aPages[i].getAttribute("data-pageid");
				if( sPageId == sId ) {
					aPages[i].style.display = 'block';
				} else {
					aPages[i].style.display = 'none';
				}
			}
			menuHighlight( sId );			
		}
		
		function menuHighlight( sId ) {
			for( var i = 0 ; i < aMenuIds.length ; i++ ) {
				if( sId == aMenuIds[i].getAttribute( "data-menuid") ) {
					aMenuIds[i].className='active';
				} else {
					aMenuIds[i].className='normal';
				}
			}
			sMenuActiveId = sId;
		}
						
	</script>
	
</head>

<body>

<!-- Header -->
<div class='header'>
	<div class='menu'>
		<div class='logo'>&nbsp;</div>
		<div data-menuid='main'>&nbsp;&nbsp;&nbsp;&nbsp;GANNT&nbsp;&nbsp;&nbsp;&nbsp;</div>
		<div data-menuid='help'>&nbsp;&nbsp;&nbsp;&nbsp;HELP&nbsp;&nbsp;&nbsp;&nbsp;</div>
	</div>
</div>

<div class='content'>
			<div data-pageid='main'>
				<h1>MAIN</h1>
				<div id='containerDiv' style='width:90%;'>
					<svg id='containerSVG' style='margin:0; padding:0;'>
						<svg id='ganntSVG' preserveAspectRatio='none' style='margin:0; padding:0;'></svg>
						<svg id='textSVG' preserveAspectRatio='none' style='margin:0; padding:0;'></svg>
					</svg>
				</div>
			</div>
			<div data-pageid='help'>
				HELP
			</div>
</div>


<script type="text/javascript">

var NS = "http://www.w3.org/2000/svg";

var data = {
	factStartMin:-1, factFinMax:-1, asapStartMin:-1, asapFinMax:-1, min:-1, max:-1,
	oper: [
		{ level:1, code:'1', name:'Phase 1', factStart:'09.01.2007  08:00', factFin:'15.01.2007  16:00', asapStart:'30.01.2007  08:00', asapFin:'30.01.2007  08:00' },
		{ level:2, code:'2', name:'Phase 2', factStart:'15.01.2007  08:00', factFin:'30.01.2007  16:00', asapStart:'10.01.2007  08:00', asapFin:'21.01.2007  10:00' },
		{ level:null, code:'3', name:'Oper 3', factStart:'15.01.2007  08:00', factFin:'20.01.2007  16:00', asapStart:'10.01.2007  08:00', asapFin:'21.01.2007  10:00' },	
		{ level:null, code:'4', name:'Oper 4', factStart:'20.01.2007  08:00', factFin:'23.01.2007  16:00', asapStart:'10.01.2007  08:00', asapFin:'21.01.2007  10:00' },
		{ level:null, code:'5', name:'Oper 5', factStart:'23.01.2007  08:00', factFin:'30.01.2007  16:00', asapStart:'10.01.2007  08:00', asapFin:'21.01.2007  10:00' }		
	]
}

var containerDiv = null;
var containerSVG = null;
var ganntSGV = null;
var textSvg = null;

var containerDivHeight, containerDivWidth;
var ganntSVGWidth;
var textSVGWidth;

var ganntSVGCaptured=false;
var ganntSVGCapturedAtX;
var ganntSVGCapturedAtY;


let success = createGanntCanvas();
if( success ) {
	drawGanntCanvas();
}



function createGanntCanvas() {

	let plusColor = "#44AA44";
	let minusColor = "#AA4444";
	let zeroColor = "#7f7f7f";
	let backgroundColor = "#f0fff0";

	containerDiv = document.getElementById("containerDiv");
	containerDivHeight = window.innerHeight - getElementPosition(containerDiv).y - 60;
	containerDiv.style.height = containerDivHeight;
	containerDivWidth = parseInt( getComputedStyle(containerDiv).width );
	containerDiv.style.width = containerDivWidth;

	containerSVG = document.getElementById("containerSVG");
	containerSVG.setAttributeNS(null, 'x', 0 );
	containerSVG.setAttributeNS(null, 'y', 0 ); 
	containerSVG.setAttributeNS(null, 'width', containerDivWidth ); // window.innerWidth-1  );
	containerSVG.setAttributeNS(null, 'height', containerDivHeight ); 

	ganntSVG = document.getElementById("ganntSVG");
	ganntSVG.setAttributeNS(null, 'x', containerDivWidth * 0.1 );
	ganntSVG.setAttributeNS(null, 'y', 0 ); 
	ganntSVGWidth = containerDivWidth*0.9;
	ganntSVG.setAttributeNS(null, 'width', ganntSVGWidth ); // window.innerWidth * 0.9 );
	ganntSVG.setAttributeNS(null, 'height', containerDivHeight ); //window.innerHeight/2 ); 
	ganntSVG.style.background = backgroundColor;
	ganntSVG.style.cursor = "pointer";
	ganntSVG.onmousedown = function(e) {
		ganntSVGCaptured = true;
		ganntSVGCapturedAtX = e.clientX;
		ganntSVGCapturedAtY = e.clientY;
	};
	ganntSVG.onmouseup = function() {
		ganntSVGCaptured = false;
	};
	ganntSVG.onmousemove = function(e) {
		if( !ganntSVGCaptured ) {
			return;
		}
		let deltaX = ganntSVG.viewBox.baseVal.width * (e.clientX - ganntSVGCapturedAtX) / ganntSVGWidth;
		ganntSVG.viewBox.baseVal.x -= deltaX;

	};
	ganntSVG.onmouseout = function(e) {
		ganntSVGCaptured = false;
	};
	addOnMouseWheel( ganntSVG, 
		function(e) {
			let delta = e.deltaY || e.detail || e.wheelDelta;
			let zoomInc;
			if( delta > 0 ) {
				zoomInc = 0.1;
			} else {
				zoomInc = -0.1;
			}
			zoomX( zoomInc, null );
		}
	);	

	textSVG = document.getElementById('textSVG');
	textSVG.setAttributeNS(null, 'x', 0 );
	textSVG.setAttributeNS(null, 'y', 0 ); 
	textSVGWidth = containerDivWidth * 0.1;
	textSVG.setAttributeNS(null, 'width', textSVGWidth ); // window.innerWidth * 0.1 );
	textSVG.setAttributeNS(null, 'height', containerDivHeight ); 
	textSVG.style.background = backgroundColor;
	textSVG.style.cursor = "pointer";
	addOnMouseWheel( textSVG, 
		function(e) {
			let delta = e.deltaY || e.detail || e.wheelDelta;
			let zoomInc;
			if( delta > 0 ) {
				zoomInc = 0.1;
			} else {
				zoomInc = -0.1;
			}
			zoomY( zoomInc, null );
		}
	);	
	return true;
}

function drawGanntCanvas() {

	// Retrieving min. and max. dates
	var parsed;
	for( let i = 0 ; i < data.oper.length ; i++ ) {
		parsed = parseDate( data.oper[i].asapStart );
		data.asapStartMin = reassingBoundaryValue( data.asapStartMin, parsed.timeInSeconds, false );
		data.oper[i].asapStartInSeconds = parsed.timeInSeconds;

		parsed = parseDate( data.oper[i].asapFin );
		data.asapFinMax = reassingBoundaryValue( data.asapFinMax, parsed.timeInSeconds, true );
		data.oper[i].asapFinInSeconds = parsed.timeInSeconds;

		parsed = parseDate( data.oper[i].factStart );
		data.factStartMin = reassingBoundaryValue( data.factStartMin, parsed.timeInSeconds, false );
		data.oper[i].factStartInSeconds = parsed.timeInSeconds;

		parsed = parseDate( data.oper[i].factFin );
		data.factFinMax = reassingBoundaryValue( data.factFinMax, parsed.timeInSeconds, true );
		data.oper[i].factFinInSeconds = parsed.timeInSeconds;
	}
	data.min = (data.asapStartMin > data.factStartMin) ? data.factStartMin : data.asapStartMin;
	data.max = (data.asapFinMax > data.factFinMax) ? data.asapFinMax : data.factFinMax;

	ganntSVG.viewBox.baseVal.x = data.factStartMin;
	ganntSVG.viewBox.baseVal.width = data.factFinMax - data.factStartMin;

	ganntSVG.viewBox.baseVal.y = 0; // 0.0 - yMargin;
	ganntSVG.viewBox.baseVal.height = data.oper.length; // yHeight + 2.0*yMargin;

	for( let i = 0 ; i < data.oper.length ; i++ ) {
		let rect = document.createElementNS(NS, 'rect');
		rect.setAttributeNS(null, 'x', data.oper[i].factStartInSeconds ); 
		rect.setAttributeNS(null, 'width', data.oper[i].factFinInSeconds - data.oper[i].factStartInSeconds ); 
		rect.setAttributeNS(null, 'y', i ); 
		rect.setAttributeNS(null, 'height', 1 ); 
		if( data.oper[i].level == null ) {
			rect.setAttributeNS(null,"fill", "blue");
			rect.setAttributeNS(null,'stroke','pink');
			rect.setAttributeNS(null,'stroke-width',0.01);
			rect.setAttributeNS(null,'opacity','0.25');
		} else {
			rect.setAttributeNS(null,"fill", "blue");
			rect.setAttributeNS(null,'stroke','pink');
			rect.setAttributeNS(null,'stroke-width',0.01);
			rect.setAttributeNS(null,'opacity','0.5');
		}
		ganntSVG.appendChild(rect);
	}

	for( let i = 0 ; i < data.oper.length ; i++ ) {
		let text = document.createElementNS(NS, 'text');
		text.setAttributeNS(null,'x', textSVGWidth-10 );
		text.setAttributeNS(null,'y', containerDivHeight*(i - ganntSVG.viewBox.baseVal.y + 0.5) / ganntSVG.viewBox.baseVal.height );
		text.setAttributeNS(null,'font-size', 12 );
		text.setAttributeNS(null,'text-anchor', 'end' );
		text.setAttributeNS(null,'textLength', 50 );
		let textNode = document.createTextNode( data.oper[i].name );
		text.appendChild(textNode)
 		textSVG.appendChild(text);
	}

	//containerSVG.setAttribute("transform", "scale(0.5)");
	//ganntSVG.setAttribute("transform", "scale(0.5)");
}

function zoomX( zoomFactor, zoomPosition ) {
	let min = data.min;
	let max = data.max;
	let originalViewBoxWidth = max - min;
	if( zoomFactor == null && zoomPosition == null ) {
		ganntSVG.viewBox.baseVal.x = min;
		ganntSVG.viewBox.baseVal.width = originalViewBoxWidth;
		return;
	} else if( zoomFactor != null && zoomPosition == null ) {
		if( zoomFactor == '100%' ) {
			ganntSVG.viewBox.baseVal.x = min;
			ganntSVG.viewBox.baseVal.width = originalViewBoxWidth;
			return;
		}
		let currentZoomFactor = ganntSVG.viewBox.baseVal.width / originalViewBoxWidth;
		let newZoomFactor = currentZoomFactor + zoomFactor;
		if( !(newZoomFactor > 0) ) {
			return;
		}
		let newWidth = originalViewBoxWidth * newZoomFactor;
		let newX = ganntSVG.viewBox.baseVal.x - (newWidth - ganntSVG.viewBox.baseVal.width) / 2.0;	
		if( newX < min ) {
			newX = min;
		} else if( newX + newWidth > max ) {
			newX = min;
		}
		ganntSVG.viewBox.baseVal.x = newX;
		ganntSVG.viewBox.baseVal.width = newWidth;
		return;
	} else if( zoomFactor == null && zoomPosition != null ) {
		if( zoomPosition < min ) {
			zoomPosition = min;
		} 
		ganntSVG.viewBox.baseVal.x = zoomPosition;
	}
}

function zoomY( zoomInc, zoomPosition ) {

	let currentZoom = 1.0;
	transform = containerSVG.style.transform;
	//alert(transform);
	if( transform != null ) {
		if( transform.length > 0 ) {
			let matched = transform.match( /scale\(([0-9\.]+)\)/ );
			if( matched.length == 2 ) {
				currentZoom = matched[1];
			}
		}
	}
	containerSVG.setAttributeNS( null, 'transform', 'scale(' + (currentZoom+zoomInc) + ')' );
}

function parseDate( dateString ) {
    var parsed = dateString.match( /([0-9]+)\.([0-9]+)\.([0-9]+) + ([0-9]+)\:([0-9]+)/ );
    if( parsed.length != 6 ) {
    	return null;
    }
    var date = new Date(parsed[3], parsed[2], parsed[1], parsed[4], parsed[5], 0, 0);
    var timeInSeconds = date.getTime();
    return( { 'date':date, 'timeInSeconds':timeInSeconds/3600000 } ); 
}

function reassingBoundaryValue( knownBoundary, newBoundary, upperBoundary ) {
	if( knownBoundary == -1 ) {
		return newBoundary;
	} 
	if( !upperBoundary ) { // Min.
		if( newBoundary < knownBoundary ) {
			return newBoundary;			
		} 
	} else { // Max.
		if( newBoundary > knownBoundary ) {
			return newBoundary;			
		} 		
	}
	return knownBoundary;
}

function getElementPosition(el) {
	let lx=0, ly=0
    for( ; el != null ; ) {
		lx += el.offsetLeft;
		ly += el.offsetTop;
		el = el.offsetParent;    	
    }
    return {x:lx, y:ly};
}

function addOnMouseWheel(elem, handler) {
	if (elem.addEventListener) {
		if ('onwheel' in document) {           // IE9+, FF17+
			elem.addEventListener("wheel", handler);
		} else if ('onmousewheel' in document) {           // устаревший вариант события
			elem.addEventListener("mousewheel", handler);
		} else {          // 3.5 <= Firefox < 17, более старое событие DOMMouseScroll пропустим
			elem.addEventListener("MozMousePixelScroll", handler);
		}
	} else { // IE8-
		elem.attachEvent("onmousewheel", handler);
	}
}

</script>

</body>

</html
